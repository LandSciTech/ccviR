mod_results_ui <- function(id, title) {
  tabPanel(
    "Index Results",
    fluidPage(
      div(
        id = "formData",
        #style = 'width:800px;',
        h2("Index Results"),
        p("This section calculates the CCVI using the results of Sections
                A, B, C, and D. Once the index has been calculated, a report
                summarizing the results of the assessment can be generated by
                selecting the 'Generate report' button at the bottom of the page.",
          strong("Note: "), "If changes are made after the index has been
                calculated you will need to click 'Calculate' again for them to be applied."),
        h5("Click button to calculate or re-calculate the index:"),
        actionButton("calcIndex", "Calculate CCVI", class = "btn-primary")
      ),

      conditionalPanel(
        condition = "output.calcFlag == true",
        h3("Data completeness"),
        gt::gt_output("n_factors"),

        h3("Variation in index"),
        p("When multiple values are selected for any of the vulnerability ",
          "factors the average of the values is used to calculate the ",
          "overall index. To test the uncertainty in the result a Monte Carlo ",
          "simulation with 1000 runs is carried out. In each simulation run ",
          "one of the selected values is randomly chosen and the index is ",
          "calculated. The graph below shows the proportion of runs with each",
          " index value for each scenario. "),
        plotOutput("conf_graph", width = 300, height = 200),
        div(
          id = "indplt",
          #style = 'width:800px;',
          br(),
          h3("Factors contributing to index value"),
          p("The CCVI is calculated by combining the index calculated based on ",
            "exposure, sensitivity and adaptive capacity with the index ",
            "calculated based on documented or modelled responses to climate change. ",
            "The plot below demonstrates which of these had the strongest",
            "influence on the overall calculated index. The lines indicate",
            " the range of scores produced by the Monte Carlo simulations. ",
            "A score of negative one on the vertical ",
            "axis indicates none of the factors in the modelled response to",
            " climate change section were completed"),
          # Might want to add something like this to change width dependent
          # on n facets https://stackoverflow.com/questions/50914398/increase-plot-size-in-shiny-when-using-ggplot-facets

          plotOutput("ind_score_plt", height = "300px"),
          textOutput("slr"),
          br(), br(),
          p("The score for each vulnerability factor is determined by the ",
            "answers to vulnerability questions (Neutral: 0, Greatly increases: 3)",
            "multiplied by the exposure multiplier for temperature or moisture,",
            "whichever is most relevant to that factor. When multiple values ",
            "are selected for any of the vulnerability ",
            "factors the average of the values is used. These scores are summed ",
            "to determine the index. The plot below demonstrates which factors ",
            "had the highest scores and how exposure impacted the score. ",
            "The lighter coloured bars indicate the maximum possible score ",
            "for that factor. The chart is broken up by section to highlight ",
            "that the B/C and D sections affect the final score differently. ",
            "See the plot above for more details on combining the scores."),
          plotly::plotlyOutput("q_score_plt", height = "500px")
        ),
        br(),
        br(),
        actionButton("restart", "Assess another species",
                     class = "btn-primary"),
        br(),
        br(),
        downloadButton("report", "Generate report", class = "btn-primary"),


      )
    )
  )
}

mod_results_server <- function(id) {

  moduleServer(id, function(input, output, session) {



  })

}
