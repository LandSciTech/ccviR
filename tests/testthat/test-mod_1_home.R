test_that("load_previous()", {

  expect_silent(volumes <- server_setup())
  expect_silent(parse_path(volumes, test_files(mock = TRUE)$saved$final))

  expect_silent(load_previous(test_files()$saved$final))
  expect_error(load_previous(""), "File doesn't exist")
  expect_error(load_previous(test_files()$saved$empty),
               "CSV file is empty, cannot restore from file.")
})

test_that("loads data", {

  volumes <- server_setup()
  testServer(mod_home_server, args = list(volumes = volumes), {
    r <- session$getReturned()

    session$setInputs(loadcsv = test_files(mock = TRUE)$saved$final)

    expect_true(fs::file_exists(path()))

    expect_s3_class(df_loaded(), "data.frame")
    expect_equal(df_loaded(), r$df_loaded())
    expect_true(!all(is.na(df_loaded()$CCVI_index)))

    session$setInputs(loadcsv = test_files(mock = TRUE)$saved$spatial)
    expect_s3_class(df_loaded(), "data.frame")
    expect_equal(df_loaded(), r$df_loaded())
    expect_false(!all(is.na(df_loaded()$CCVI_index)))
  })
})
